{% extends "base.html" %}
{% block title %}NastavenÃ­ â€“ {{ brand.team_name or 'CoachHub' }}{% endblock %}

{% block content %}
<h1>NastavenÃ­ tÃ½mu</h1>

<div class="cards">
  <div class="card" style="text-align:left;">
    <h2>ğŸ¨ Barvy a logo</h2>
    <form method="POST" enctype="multipart/form-data" style="display:flex; flex-direction:column; gap:12px; max-width:520px;">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <input type="hidden" name="action" value="brand">
      <div style="display:flex; align-items:end; gap:16px; flex-wrap:wrap;">
        <label>PrimÃ¡rnÃ­ barva<br>
          <input id="primCol" type="color" name="primary_color" value="{{ brand.primary or '#d4c76f' }}" style="width:60px; height:36px; padding:0; border:none;">
        </label>
        <button type="button" id="btnSwapColors" style="height:36px; align-self:flex-end;">â†” Prohodit barvy</button>
        <label>SekundÃ¡rnÃ­ barva<br>
          <input id="secCol" type="color" name="secondary_color" value="{{ brand.secondary or '#000000' }}" style="width:60px; height:36px; padding:0; border:none;">
        </label>
      </div>
      <label>Logo tÃ½mu (PNG/JPG)<br>
        <input type="file" name="team_logo" accept="image/*">
      </label>
      <button type="submit">ğŸ’¾ UloÅ¾it zmÄ›ny</button>
    </form>
  </div>

  <div class="card">
    <h2>AktuÃ¡lnÃ­ logo</h2>
    {% if brand.logo_url %}
      <img src="{{ brand.logo_url }}" alt="Team Logo" style="max-width:300px; background:#fff; border-radius:8px; border:2px solid var(--brand-primary, #d4c76f);">
    {% else %}
      <p><i>ZatÃ­m Å¾Ã¡dnÃ© logo</i></p>
    {% endif %}
  </div>

  <div class="card" style="text-align:left;">
    <h2>ğŸ‘¤ ÃšÄet</h2>
    <form method="POST" style="display:flex; flex-direction:column; gap:12px; max-width:520px;">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <input type="hidden" name="action" value="account">
      <label>Email<br>
        <input type="email" name="email" value="{{ current_user.email }}">
      </label>
      <label>UÅ¾ivatelskÃ© jmÃ©no (username)<br>
        <input type="text" name="username" value="{{ current_user.username or '' }}" placeholder="volitelnÃ©">
      </label>
      <div style="display:flex; gap:12px; flex-wrap:wrap;">
        <label>AktuÃ¡lnÃ­ heslo<br>
          <input type="password" name="current_password" placeholder="vyÅ¾adovÃ¡no pro zmÄ›nu hesla">
        </label>
        <label>NovÃ© heslo<br>
          <input type="password" name="new_password" placeholder="ponech prÃ¡zdnÃ©, pokud nechceÅ¡ mÄ›nit">
        </label>
      </div>
      <button type="submit">ğŸ’¾ UloÅ¾it zmÄ›ny ÃºÄtu</button>
    </form>
    <form method="POST" class="form-confirm" data-message="Opravdu smazat profil? Tato akce je nevratnÃ¡." style="margin-top:12px;">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <input type="hidden" name="action" value="delete">
      <button type="submit" style="background:#b33; color:#fff;">ğŸ—‘ Smazat profil</button>
    </form>
  </div>

  {% if current_user.is_team_admin %}
  <div class="card" style="text-align:left; grid-column: 1 / -1;">
    <h2>ğŸ‘¥ ÄŒlenovÃ© tÃ½mu</h2>
    {% if members %}
      <table style="width:100%; border-collapse:collapse;">
        <thead>
          <tr style="text-align:left; border-bottom:1px solid #666;">
            <th>JmÃ©no</th>
            <th>Email</th>
            <th>Username</th>
            <th>Role</th>
            <th>SchvÃ¡len</th>
            <th>Admin</th>
            <th>Akce</th>
          </tr>
        </thead>
        <tbody>
          {% for u in members %}
            <tr style="border-bottom:1px solid #333;">
              <td>{{ (u.first_name or '') ~ (' ' if u.first_name and u.last_name else '') ~ (u.last_name or '') }}</td>
              <td>{{ u.email }}</td>
              <td>{{ u.username or '-' }}</td>
              <td>
                <form method="POST" action="{{ url_for('team_members_action') }}" style="display:inline-flex; gap:6px; align-items:center;">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="hidden" name="user_id" value="{{ u.id }}">
                  <input type="hidden" name="action" value="set_role">
                  <select name="value">
                    <option value="coach" {% if u.role=='coach' %}selected{% endif %}>coach</option>
                    <option value="player" {% if u.role=='player' %}selected{% endif %}>player</option>
                  </select>
                  <button type="submit">UloÅ¾it</button>
                </form>
              </td>
              <td>{{ 'Ano' if u.is_approved else 'Ne' }}</td>
              <td>{{ 'Ano' if u.is_team_admin else 'Ne' }}</td>
              <td style="display:flex; gap:6px; flex-wrap:wrap;">
                {% if not u.is_approved %}
                  <form method="POST" action="{{ url_for('team_members_action') }}">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="user_id" value="{{ u.id }}">
                    <input type="hidden" name="action" value="approve">
                    <button type="submit">âœ” SchvÃ¡lit</button>
                  </form>
                {% else %}
                  <form method="POST" action="{{ url_for('team_members_action') }}">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="user_id" value="{{ u.id }}">
                    <input type="hidden" name="action" value="revoke">
                    <button type="submit">â¸ Odebrat pÅ™Ã­stup</button>
                  </form>
                {% endif %}
                {% if not u.is_team_admin %}
                  <form method="POST" action="{{ url_for('team_members_action') }}">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="user_id" value="{{ u.id }}">
                    <input type="hidden" name="action" value="make_admin">
                    <button type="submit">â­ UdÄ›lit admin</button>
                  </form>
                {% else %}
                  <form method="POST" action="{{ url_for('team_members_action') }}" class="form-confirm" data-message="Odebrat admin prÃ¡va?">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="user_id" value="{{ u.id }}">
                    <input type="hidden" name="action" value="remove_admin">
                    <button type="submit">â˜† Odebrat admin</button>
                  </form>
                {% endif %}
                {% if u.id != current_user.id %}
                  <form method="POST" action="{{ url_for('team_members_action') }}" class="form-confirm" data-message="Odebrat Älena z tÃ½mu?">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="user_id" value="{{ u.id }}">
                    <input type="hidden" name="action" value="remove_member">
                    <button type="submit" style="background:#b33; color:#fff;">ğŸ—‘ Odebrat z tÃ½mu</button>
                  </form>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p><i>Å½Ã¡dnÃ­ ÄlenovÃ©</i></p>
    {% endif %}
  </div>
  {% endif %}
</div>

{% endblock %}

{% block scripts %}{% endblock %}
