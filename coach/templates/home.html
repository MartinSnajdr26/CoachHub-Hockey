{% extends "base.html" %}
{% block title %}Coach Manager – Domů{% endblock %}

{% block content %}

<div style="display:flex; gap:20px; align-items:flex-start; flex-wrap:wrap;">
  <div style="flex:1; min-width:280px; display:flex; align-items:flex-start; justify-content:flex-start;">
    <div style="text-align:left; width:100%;">
      
      <div class="cards" style="margin-top:0; display:grid; grid-template-columns: repeat(2, minmax(200px, 1fr)); gap:16px;">
          <div class="card">
              <h2>👥 Hráči</h2>
              <p>Správa kádru, přidávání a mazání hráčů.</p>
              <a href="/players"><button>Otevřít</button></a>
          </div>
          <div class="card">
              <h2>📋 Soupiska</h2>
              <p>Vyber nominaci na zápas a připrav soupisku.</p>
              <a href="/roster"><button>Otevřít</button></a>
          </div>
          <div class="card">
              <h2>🏒 Lajny</h2>
              <p>Rozděl hráče do lajn a sestav útoky i obrany.</p>
              <a href="/lines"><button>Otevřít</button></a>
          </div>
          <div class="card">
              <h2>📝 Tréninky</h2>
              <p>Vytvářej a ukládej cvičení, plánuj tréninky.</p>
              <a href="/drills"><button>Otevřít</button></a>
          </div>
      </div>
    </div>
  </div>

  <div style="flex:1; min-width:520px; max-width:700px;">
    <h2 style="margin:0 0 8px;">{{ month_title }}</h2>
    <p style="margin:0 4px 6px; display:flex; align-items:center; gap:8px; flex-wrap:wrap; border:2px solid var(--brand-secondary, #000); border-radius:8px; padding:6px 8px; background:#fff;">
      <a href="{{ url_for('home', year=prev_year, month=prev_month) }}"><button>◀ Předchozí</button></a>
      <a href="{{ url_for('home') }}"><button>Dnes</button></a>
      <a href="{{ url_for('home', year=next_year, month=next_month) }}"><button>Další ▶</button></a>
      <span style="margin-left:12px; opacity:0.8;">Dnes: {{ today_label }}</span>
    </p>
    <p style="margin:0 0 10px; display:flex; align-items:center; gap:14px;">
      <span style="display:inline-flex; align-items:center; gap:6px;">
        <span style="display:inline-block; width:8px; height:6px; background: var(--brand-primary, #d4c76f); border:2px solid var(--brand-secondary, #000); border-radius:2px;"></span>
        Trénink
      </span>
      <span style="display:inline-flex; align-items:center; gap:6px;">
        <span style="display:inline-block; width:8px; height:6px; background: var(--brand-secondary, #000); border:2px solid var(--brand-primary, #d4c76f); border-radius:2px;"></span>
        Zápas
      </span>
    </p>
    <table style="width:100%; border-collapse:collapse; background:#fff; color:#000;">
      <thead>
        <tr>
          {% for wd in ['Po','Út','St','Čt','Pá','So','Ne'] %}
            <th style="border:1px solid #ccc; padding:6px; background:#eee;">{{ wd }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for week in weeks %}
          <tr>
            {% for day in week %}
              {% set in_month = (day.month == cal_month) %}
              {% set is_today = (day.isoformat() == today_iso) %}
              <td style="vertical-align:top; border:1px solid #ccc; padding:6px; width:14.28%; background: {{ '#fff' if in_month else '#f4f4f4' }}; {{ 'outline:3px solid var(--brand-primary, #d4c76f); box-shadow: inset 0 0 0 1000px rgba(196,71,71,0.38);' if is_today else '' }}">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                  {% if is_today %}
                    <strong style="color:#c44747; font-weight:800;">{{ day.day }}</strong>
                  {% else %}
                    <strong>{{ day.day }}</strong>
                  {% endif %}
                  {% if in_month and current_user.is_authenticated and current_user.role == 'coach' %}
                    <details>
                      <summary style="cursor:pointer; font-size:12px; line-height:1;">➕</summary>
                      <form method="POST" action="{{ url_for('calendar_add') }}" style="display:flex; flex-direction:column; gap:6px; margin-top:6px;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="hidden" name="day" value="{{ day.isoformat() }}">
                        <label style="font-size:12px;">
                          Čas (24h)
                          <input type="text" name="time" value="18:00" pattern="^([01]\\d|2[0-3]):[0-5]\\d$" placeholder="HH:MM" inputmode="numeric" style="padding:4px 6px; border:1px solid #bbb; border-radius:6px;">
                        </label>
                        <input type="text" name="title" placeholder="Název (např. Trénink A)" style="padding:4px 6px; border:1px solid #bbb; border-radius:6px;">
                        <label style="font-size:12px;">Typ
                          <select name="kind">
                            <option value="training" selected>Trénink</option>
                            <option value="match">Zápas</option>
                          </select>
                        </label>
                        <button type="submit">Přidat</button>
                      </form>
                    </details>
                  {% endif %}
                </div>
                {% set key = day.isoformat() %}
                {% for ev in events_by_day.get(key, []) %}
                  {% set c = 'var(--brand-primary, #d4c76f)' if (ev.kind or 'training') == 'training' else 'var(--brand-secondary, #000)' %}
                  <div style="margin-top:4px; padding:4px 6px; border-left:3px solid {{ c }}; background:#f7f7f7; border-radius:4px; font-size:14px;">
                    <b>{{ ev.time or '' }}</b> {{ ev.title }}
                    {% if current_user.is_authenticated and current_user.role == 'coach' %}
                      <details>
                        <summary style="cursor:pointer; font-size:12px; opacity:0.8;">Upravit</summary>
                        <form method="POST" action="{{ url_for('calendar_update') }}" style="display:flex; gap:6px; align-items:center; flex-wrap:wrap; margin-top:6px;">
                          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                          <input type="hidden" name="id" value="{{ ev.id }}">
                          <label style="font-size:12px;">
                            Čas (24h)
                            <input type="text" name="time" value="{{ ev.time or '' }}" pattern="^([01]\\d|2[0-3]):[0-5]\\d$" placeholder="HH:MM" inputmode="numeric" style="padding:4px 6px; border:1px solid #bbb; border-radius:6px;">
                          </label>
                          <input type="text" name="title" value="{{ ev.title }}" style="padding:4px 6px; border:1px solid #bbb; border-radius:6px;">
                          <select name="kind">
                            <option value="training" {% if (ev.kind or 'training')=='training' %}selected{% endif %}>Trénink</option>
                            <option value="match" {% if (ev.kind or 'training')=='match' %}selected{% endif %}>Zápas</option>
                          </select>
                          <button type="submit">Uložit</button>
                        </form>
                        <form method="POST" action="{{ url_for('calendar_delete') }}" class="form-confirm" data-message="Smazat událost?" style="margin-top:6px;">
                          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                          <input type="hidden" name="id" value="{{ ev.id }}">
                          <button type="submit" style="background:#b33; color:#fff;">🗑 Smazat</button>
                        </form>
                      </details>
                    {% endif %}
                  </div>
                {% endfor %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
