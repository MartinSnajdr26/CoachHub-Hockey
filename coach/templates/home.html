{% extends "base.html" %}
{% block title %}Coach Manager ‚Äì Dom≈Ø{% endblock %}

{% block content %}

<div class="home-wrap">
  <div class="home-cards-col">
    <div style="text-align:left; width:100%;">
      
      <div class="cards cards-home">
          <div class="card">
              <h2>üë• Hr√°ƒçi</h2>
              <p>Spr√°va k√°dru, p≈ôid√°v√°n√≠ a maz√°n√≠ hr√°ƒç≈Ø.</p>
              <a href="/players"><button>Otev≈ô√≠t</button></a>
          </div>
          <div class="card">
              <h2>üìã Soupiska</h2>
              <p>Vyber nominaci na z√°pas a p≈ôiprav soupisku.</p>
              <a href="/roster"><button>Otev≈ô√≠t</button></a>
          </div>
          <div class="card">
              <h2>üèí Formace</h2>
              <p>Rozdƒõl hr√°ƒçe do lajn a sestav √∫toky i obrany.</p>
              <a href="/lines"><button>Otev≈ô√≠t</button></a>
          </div>
          <div class="card">
              <h2>üìù Tr√©ninky</h2>
              <p>Vytv√°≈ôej a ukl√°dej cviƒçen√≠, pl√°nuj tr√©ninky.</p>
              <a href="/drills"><button>Otev≈ô√≠t</button></a>
          </div>
      </div>
    </div>
  </div>

  <div class="calendar-col">
    <h2 class="month-title" style="margin:0 0 8px;">{{ month_title }}</h2>
    <p style="margin:0 4px 6px; display:flex; align-items:center; gap:8px; flex-wrap:wrap; border:2px solid var(--brand-secondary, #000); border-radius:8px; padding:6px 8px; background:#fff; color: var(--brand-secondary, #000);">
      <a href="{{ url_for('home', year=prev_year, month=prev_month) }}"><button>‚óÄ P≈ôedchoz√≠</button></a>
      <a href="{{ url_for('home') }}"><button>Dnes</button></a>
      <a href="{{ url_for('home', year=next_year, month=next_month) }}"><button>Dal≈°√≠ ‚ñ∂</button></a>
      <span style="margin-left:12px; opacity:0.8;">Dnes: {{ today_label }}</span>
    </p>
    <p class="calendar-legend" style="margin:0 0 10px; display:flex; align-items:center; gap:14px;">
      <span style="display:inline-flex; align-items:center; gap:6px;">
        <span style="display:inline-block; width:8px; height:6px; background: var(--brand-primary, #d4c76f); border:2px solid var(--brand-secondary, #000); border-radius:2px;"></span>
        Tr√©nink
      </span>
      <span style="display:inline-flex; align-items:center; gap:6px;">
        <span style="display:inline-block; width:8px; height:6px; background: var(--brand-secondary, #000); border:2px solid var(--brand-primary, #d4c76f); border-radius:2px;"></span>
        Z√°pas
      </span>
    </p>
    <div class="calendar-wrap table-scroll">
    <table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          {% for wd in ['Po','√öt','St','ƒåt','P√°','So','Ne'] %}
            <th>{{ wd }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for week in weeks %}
          <tr>
            {% for day in week %}
              {% set in_month = (day.month == cal_month) %}
              {% set is_today = (day.isoformat() == today_iso) %}
              <td class="cal-cell {{ 'in-month' if in_month else 'out-month' }} {{ 'is-today' if is_today else '' }}">
                <div class="cal-cell-head" style="display:flex; justify-content:space-between; align-items:center;">
                  {% if is_today %}
                    <strong style="color: var(--tertiary, #c44747); font-weight:800;">{{ day.day }}</strong>
                  {% else %}
                    <strong>{{ day.day }}</strong>
                  {% endif %}
                  {% if in_month and is_coach %}
                    <details>
                      <summary style="cursor:pointer; font-size:12px; line-height:1;">‚ûï</summary>
                      <form method="POST" action="{{ url_for('calendar_add') }}" style="display:flex; flex-direction:column; gap:6px; margin-top:6px;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="hidden" name="day" value="{{ day.isoformat() }}">
                        <label style="font-size:12px;">
                          ƒåas (24h)
                          <span style="display:inline-flex; gap:4px; align-items:center;">
                            <select name="time_hour" style="padding:4px 6px; border:1px solid #bbb; border-radius:6px;">
                              {% for h in range(0,24) %}
                                {% set h2 = '%02d' % h %}
                                <option value="{{ h2 }}" {% if h==18 %}selected{% endif %}>{{ h2 }}</option>
                              {% endfor %}
                            </select>
                            :
                            <select name="time_minute" style="padding:4px 6px; border:1px solid #bbb; border-radius:6px;">
                              {% for m in range(0,60) %}
                                {% set m2 = '%02d' % m %}
                                <option value="{{ m2 }}" {% if m==0 %}selected{% endif %}>{{ m2 }}</option>
                              {% endfor %}
                            </select>
                          </span>
                        </label>
                        <input type="text" name="title" placeholder="N√°zev (nap≈ô. Tr√©nink A)" style="padding:4px 6px; border:1px solid #bbb; border-radius:6px;">
                        <label style="font-size:12px;">Typ
                          <select name="kind">
                            <option value="training" selected>Tr√©nink</option>
                            <option value="match">Z√°pas</option>
                          </select>
                        </label>
                        <button type="submit">P≈ôidat</button>
                      </form>
                    </details>
                  {% endif %}
                </div>
                {% set key = day.isoformat() %}
                {% for ev in events_by_day.get(key, []) %}
                  {% set c = 'var(--brand-primary, #d4c76f)' if (ev.kind or 'training') == 'training' else 'var(--brand-secondary, #000)' %}
                  <div class="cal-event" style="border-left:3px solid {{ c }};">
                    <b>{{ ev.time or '' }}</b> {{ ev.title }}
                    {% if is_coach %}
                      <details>
                        <summary style="cursor:pointer; font-size:12px; opacity:0.8;">Upravit</summary>
                        <form method="POST" action="{{ url_for('calendar_update') }}" style="display:flex; gap:6px; align-items:center; flex-wrap:wrap; margin-top:6px;">
                          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                          <input type="hidden" name="id" value="{{ ev.id }}">
                          <label style="font-size:12px;">
                            ƒåas (24h)
                            {% set th = (ev.time or '00:00')[:2] %}
                            {% set tm = (ev.time or '00:00')[3:5] %}
                            <span style="display:inline-flex; gap:4px; align-items:center;">
                              <select name="time_hour" style="padding:4px 6px; border:1px solid #bbb; border-radius:6px;">
                                {% for h in range(0,24) %}
                                  {% set h2 = '%02d' % h %}
                                  <option value="{{ h2 }}" {% if h2==th %}selected{% endif %}>{{ h2 }}</option>
                                {% endfor %}
                              </select>
                              :
                              <select name="time_minute" style="padding:4px 6px; border:1px solid #bbb; border-radius:6px;">
                                {% for m in range(0,60) %}
                                  {% set m2 = '%02d' % m %}
                                  <option value="{{ m2 }}" {% if m2==tm %}selected{% endif %}>{{ m2 }}</option>
                                {% endfor %}
                              </select>
                            </span>
                          </label>
                          <input type="text" name="title" value="{{ ev.title }}" style="padding:4px 6px; border:1px solid #bbb; border-radius:6px;">
                          <select name="kind">
                            <option value="training" {% if (ev.kind or 'training')=='training' %}selected{% endif %}>Tr√©nink</option>
                            <option value="match" {% if (ev.kind or 'training')=='match' %}selected{% endif %}>Z√°pas</option>
                          </select>
                          <button type="submit">Ulo≈æit</button>
                        </form>
                        <form method="POST" action="{{ url_for('calendar_delete') }}" class="form-confirm" data-message="Smazat ud√°lost?" style="margin-top:6px;">
                          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                          <input type="hidden" name="id" value="{{ ev.id }}">
                          <button type="submit" style="background: var(--tertiary, #c44747); color:#fff;">üóë Smazat</button>
                        </form>
                      </details>
                    {% endif %}
                  </div>
                {% endfor %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
    </div>
  </div>
</div>

{% endblock %}
