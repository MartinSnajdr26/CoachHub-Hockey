{% extends "base.html" %}
{% block title %}Seznam trÃ©ninkovÃ½ch jednotek{% endblock %}

{% block content %}
<h1>Seznam trÃ©ninkovÃ½ch jednotek</h1>

<p style="margin-bottom:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
  <a href="{{ url_for('drills_select') }}"><button>â• NovÃ½ export</button></a>
  <a href="{{ url_for('drills') }}">â† ZpÄ›t na kategorie</a>
  <span style="font-size:12px; opacity:0.8;">StarÃ© neuloÅ¾enÃ© exporty se maÅ¾ou automaticky.</span>
  </p>

<div class="cards">
  {% for s in sessions %}
    <div class="card">
      <h2>{{ s.title }}</h2>
      <p><b>VytvoÅ™eno:</b> {{ s.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
      {% set abs = url_for('download_export', filename=s.filename, _external=True) %}
      {% if s.filename and s.filename != '-' %}
        <p>
          <a href="{{ url_for('download_export', filename=s.filename) }}" download><button>â¬‡ï¸ StÃ¡hnout PDF</button></a>
          <a href="{{ url_for('download_export', filename=s.filename) }}" target="_blank"><button>ğŸ‘ OtevÅ™Ã­t</button></a>
          <a href="https://api.whatsapp.com/send?text={{ ('TrÃ©ninkovÃ¡ jednotka: ' ~ s.title ~ ' ' ~ abs) | urlencode }}" target="_blank"><button>ğŸ“² SdÃ­let odkaz</button></a>
          <button type="button" class="btn-share-pdf" data-url="{{ abs }}" data-filename="{{ s.filename }}">ğŸ“ SdÃ­let soubor</button>
        </p>
        <p>
          {% set abs_page = url_for('drills.drill_session_detail', sess_id=s.id, _external=True) %}
          <a href="{{ url_for('drills.drill_session_detail', sess_id=s.id) }}"><button>ğŸ‘ OtevÅ™Ã­t strÃ¡nku trÃ©ninku</button></a>
          <a href="https://api.whatsapp.com/send?text={{ ('TrÃ©ninkovÃ¡ jednotka: ' ~ s.title ~ ' ' ~ abs_page) | urlencode }}" target="_blank"><button>ğŸ“² SdÃ­let strÃ¡nku</button></a>
        </p>
      {% else %}
        <p style="opacity:0.8; font-size:14px;">SloÅ¾ka trÃ©ninku (bez PDF)</p>
        <p>
          {% set abs_page = url_for('drills.drill_session_detail', sess_id=s.id, _external=True) %}
          <a href="{{ url_for('drills.drill_session_detail', sess_id=s.id) }}"><button>ğŸ‘ OtevÅ™Ã­t strÃ¡nku trÃ©ninku</button></a>
          <a href="https://api.whatsapp.com/send?text={{ ('TrÃ©ninkovÃ¡ jednotka: ' ~ s.title ~ ' ' ~ abs_page) | urlencode }}" target="_blank"><button>ğŸ“² SdÃ­let strÃ¡nku</button></a>
        </p>
      {% endif %}
      {% set ids = (s.drill_ids or '') %}
      {% set id_list = ids.split(',') if ids else [] %}
      {% if id_list %}
        <p><b>Obsahuje cviÄenÃ­:</b></p>
        <ul>
        {% for sid in id_list %}
          {% set did = sid|int if sid else None %}
          {% set d = drills_by_id.get(did) %}
          {% if d %}
            <li><a href="{{ url_for('drill_detail', drill_id=d.id) }}">{{ d.name }}</a> <span style="opacity:0.7;">({{ d.category or '-' }})</span></li>
          {% endif %}
        {% endfor %}
        </ul>
      {% endif %}
      {% if current_user.is_authenticated and current_user.role == 'coach' %}
      <form method="post" action="{{ url_for('delete_drill_session', sess_id=s.id) }}" onsubmit="return confirm('Smazat zÃ¡znam exportu? PDF bude odstranÄ›no.');">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" style="background:#b33; color:#fff;">ğŸ—‘ Smazat</button>
      </form>
      {% endif %}
    </div>
  {% else %}
    <p><i>ZatÃ­m Å¾Ã¡dnÃ© exportovanÃ© trÃ©ninkovÃ© jednotky</i></p>
  {% endfor %}
</div>

{% endblock %}

{# moved to static/app.js #}
