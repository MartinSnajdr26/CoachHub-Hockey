{% extends "base.html" %}
{% block title %}Export dokonÄen{% endblock %}

{% block content %}
<h1>Export dokonÄen</h1>

<p>
  Soubor byl vytvoÅ™en: <b>{{ filename }}</b>
</p>

<p style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
  <a href="{{ file_url }}" download><button>â¬‡ï¸ StÃ¡hnout PDF</button></a>
  <a href="{{ file_url }}" target="_blank"><button>ğŸ‘ OtevÅ™Ã­t</button></a>
  <a href="https://api.whatsapp.com/send?text={{ ('TrÃ©ninky PDF: ' + abs_url) | urlencode }}" target="_blank"><button>ğŸ“² SdÃ­let odkaz (WhatsApp)</button></a>
  <button type="button" onclick="sharePdf('{{ abs_url }}','{{ filename }}')">ğŸ“ SdÃ­let soubor (pokud lze)</button>
  <a href="{{ url_for('drills_select') }}"><button>â†©ï¸ ZpÄ›t na vÃ½bÄ›r</button></a>
  <a href="{{ url_for('drills') }}">â† ZpÄ›t na kategorie</a>
  <span style="font-size:12px; opacity:0.8;">Pozn.: SdÃ­lenÃ­ funguje, pokud je aplikace dostupnÃ¡ externÄ›.</span>
</p>

<iframe src="{{ file_url }}" style="width:100%; max-width:1000px; height:70vh; border:2px solid #d4c76f; border-radius:8px; background:#fff;"></iframe>

<script>
async function sharePdf(url, filename){
  try {
    const resp = await fetch(url);
    const blob = await resp.blob();
    const name = filename && filename.endsWith('.pdf') ? filename : (filename || 'trenink.pdf');
    const file = new File([blob], name, { type: blob.type || 'application/pdf' });
    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      await navigator.share({ files: [file], title: name, text: name });
      return;
    }
  } catch (e) {}
  // Fallback: otevÅ™i WhatsApp s odkazem
  const msg = encodeURIComponent('TrÃ©ninkovÃ¡ jednotka: ' + (filename || '') + ' ' + url);
  window.open('https://api.whatsapp.com/send?text=' + msg, '_blank');
}
</script>

{% endblock %}
